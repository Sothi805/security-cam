# =================================================================
#                    CCTV System Configuration
#                   Complete Environment Variables
# =================================================================
# 
# This file contains all 68+ configurable environment variables
# Copy this file to .env and modify values for your setup
#
# Units Guide:
# - Time: seconds (s), minutes (min), hours (h), days (d), milliseconds (ms)
# - Size: bytes (B), KB/MB/GB for storage, pixels (px) for video
# - Bitrate: k = 1,000 bits/sec, M = 1,000,000 bits/sec
# - Memory: MB = megabytes, GB = gigabytes
# =================================================================

# =================================================================
# SERVER CONFIGURATION
# =================================================================

# Application environment (development/production)
NODE_ENV=development

# HTTP server port (1-65535)
PORT=3000

# Graceful shutdown timeout in milliseconds (1000-300000)
# How long to wait for connections to close before forcing shutdown
GRACEFUL_SHUTDOWN_TIMEOUT=30000

# Browser cache duration for static files in seconds (0-31536000)
# 31536000 = 1 year, 86400 = 1 day
CACHE_CONTROL_MAX_AGE=31536000

# =================================================================
# CAMERA CONFIGURATION
# =================================================================

# Comma-separated list of camera IDs (any alphanumeric)
# These will be used in URLs like /hls/1/live/low.m3u8
CAMERA_IDS=1,102,202

# RTSP authentication credentials
RTSP_USER=admin
RTSP_PASS=change_this_password

# RTSP server connection details
RTSP_HOST=192.168.1.100
RTSP_PORT=554
RTSP_TRANSPORT=tcp

# =================================================================
# HLS STREAMING CONFIGURATION
# =================================================================

# Directory for HLS files (relative or absolute path)
HLS_ROOT=hls

# Video segment duration in seconds (1-30)
# Shorter = lower latency, more CPU usage
# Development: 10s, Production: 5s
SEGMENT_DURATION=10

# Number of segments to keep in playlist (3-50)
# Higher = more buffer, more disk usage
HLS_LIST_SIZE=6

# FFmpeg HLS flags (advanced users only)
HLS_FLAGS=delete_segments+append_list

# =================================================================
# VIDEO QUALITY SETTINGS
# =================================================================

# Low Quality Stream Resolution in pixels (320-1920 x 240-1080)
# Development: 640x360 (fast), Production: 1280x720 (quality)
LOW_QUALITY_WIDTH=640
LOW_QUALITY_HEIGHT=360

# Frame rate in frames per second (1-60)
# Development: 8fps (fast), Production: 15fps (smooth)
LOW_QUALITY_FPS=8

# Video bitrate (100k-10M)
# k = 1,000 bits/sec, M = 1,000,000 bits/sec
# Development: 400k (fast), Production: 2M (quality)
LOW_QUALITY_BITRATE=400k

# FFmpeg encoding preset (speed vs quality tradeoff)
# ultrafast > superfast > veryfast > faster > fast > medium > slow > slower > veryslow
# Development: ultrafast (CPU friendly), Production: fast (balanced)
LOW_QUALITY_PRESET=ultrafast

# H.264 profile (baseline/main/high)
# baseline = basic compatibility, main = better compression, high = best quality
LOW_QUALITY_PROFILE=baseline

# H.264 level (1.0-5.2)
# Higher = more features but requires more powerful decoders
LOW_QUALITY_LEVEL=3.0

# =================================================================
# AUDIO SETTINGS
# =================================================================

# Audio codec (aac/mp3/opus)
# aac = best compatibility, opus = best quality
AUDIO_CODEC=aac

# Audio bitrate (16k-320k)
# Development: 32k (bandwidth friendly), Production: 128k (quality)
AUDIO_BITRATE=32k

# Audio sample rate in Hz (8000/16000/22050/44100/48000)
# Development: 22050 (efficient), Production: 44100 (CD quality)
AUDIO_SAMPLE_RATE=22050

# =================================================================
# STORAGE CONFIGURATION
# =================================================================

# How long to keep recordings in minutes (1-525600)
# 60 = 1 hour, 1440 = 1 day, 43200 = 30 days
# Development: 60 (save space), Production: 43200 (compliance)
RETENTION_MINUTES=60

# How often to run cleanup in minutes (1-1440)
# Development: 5min (frequent), Production: 15min (efficient)
CLEANUP_INTERVAL_MINUTES=5

# Maximum storage allocation in gigabytes (1-10000)
# Development: 10GB (testing), Production: 500GB (real use)
MAX_STORAGE_GB=10

# Delay before first cleanup in seconds (1-3600)
INITIAL_CLEANUP_DELAY_SECONDS=5

# Storage usage percentage to trigger emergency cleanup (50-99)
EMERGENCY_CLEANUP_THRESHOLD=95

# Storage usage percentage to show warnings (50-95)
WARNING_THRESHOLD=80

# Maximum age for orphaned files in hours (1-168)
# Files without proper references will be deleted after this time
ORPHANED_FILE_MAX_AGE_HOURS=1

# =================================================================
# FFMPEG CONFIGURATION
# =================================================================

# Path to FFmpeg executable
# Windows: ffmpeg.exe, Linux/Mac: /usr/bin/ffmpeg or ffmpeg
FFMPEG_PATH=ffmpeg

# FFmpeg logging level (quiet/panic/fatal/error/warning/info/verbose/debug/trace)
# Development: error (clean), Production: warning (some info)
FFMPEG_LOG_LEVEL=error

# =================================================================
# RECORDING CONFIGURATION
# =================================================================

# Enable continuous recording to files (true/false)
# Development: false (save resources), Production: true (security)
ENABLE_RECORDING=false

# Recording file format (mp4/mkv/avi)
RECORDING_FORMAT=mp4

# Duration of each recording segment in minutes (1-1440)
# Development: 30min (testing), Production: 60min (management)
RECORDING_SEGMENT_MINUTES=30

# =================================================================
# SYSTEM RESTART & HEALTH MONITORING
# =================================================================

# Maximum camera restart attempts (1-100)
# Development: 3 (fast fail), Production: 10 (persistence)
MAX_RESTART_ATTEMPTS=3

# Delay between restart attempts in seconds (1-300)
RESTART_DELAY_SECONDS=5

# How often to check camera health in seconds (10-3600)
HEALTH_CHECK_INTERVAL_SECONDS=30

# Pause between individual stream restarts in seconds (1-60)
STREAM_RESTART_PAUSE_SECONDS=2

# Pause between restarting all cameras in seconds (1-60)
ALL_CAMERAS_RESTART_PAUSE_SECONDS=3

# When to consider playlist stale in minutes (1-60)
PLAYLIST_STALE_THRESHOLD_MINUTES=5

# =================================================================
# MONITORING & LOGGING
# =================================================================

# Enable system monitoring features (true/false)
ENABLE_MONITORING=true

# Application log level (error/warn/info/debug)
# Development: debug (detailed), Production: info (balanced)
LOG_LEVEL=debug

# How long to keep log files in days (1-365)
# Development: 3 days (save space), Production: 30 days (troubleshooting)
LOG_RETENTION_DAYS=3

# =================================================================
# LOG FILE CONFIGURATION
# =================================================================

# Maximum size per log file in bytes (1048576-104857600)
# 5242880 = 5MB, 10485760 = 10MB
LOG_MAX_FILE_SIZE=5242880

# Maximum number of log files to keep (1-100)
LOG_MAX_FILES=3

# Maximum cleanup log file size in bytes (1048576-52428800)
CLEANUP_LOG_MAX_SIZE=2097152

# Maximum cleanup log files to keep (1-50)
CLEANUP_LOG_MAX_FILES=2

# Maximum stream log files to keep (1-50)
STREAM_LOG_MAX_FILES=2

# Maximum system log files to keep (1-50)
SYSTEM_LOG_MAX_FILES=2

# =================================================================
# PM2 PROCESS MANAGEMENT CONFIGURATION
# =================================================================

# Number of PM2 instances (1-16)
# Usually 1 for streaming applications
PM2_INSTANCES=1

# Memory limit before restart (512M-32G)
# Development: 1G (limited), Production: 4G (stable)
PM2_MAX_MEMORY_RESTART=1G

# Maximum restarts per hour (1-100)
PM2_MAX_RESTARTS=5

# Minimum uptime before considering stable (1s-300s)
PM2_MIN_UPTIME=10s

# Delay between restarts in milliseconds (1000-60000)
PM2_RESTART_DELAY=3000

# Time to wait before killing process in milliseconds (5000-120000)
PM2_KILL_TIMEOUT=15000

# Time to wait for process to start in milliseconds (1000-60000)
PM2_LISTEN_TIMEOUT=5000

# Grace period for health checks in milliseconds (5000-120000)
PM2_HEALTH_CHECK_GRACE_PERIOD=15000

# Node.js heap size limit in megabytes (512-32768)
# Development: 2048MB (2GB), Production: 8192MB (8GB)
NODE_MAX_OLD_SPACE_SIZE=2048

# =================================================================
# CORS (Cross-Origin Resource Sharing) CONFIGURATION
# =================================================================

# Allowed origins (* for all, or comma-separated URLs)
# Development: * (permissive), Production: specific domains
CORS_ORIGIN=*

# Allowed HTTP methods
CORS_METHODS=GET,POST,PUT,DELETE

# Allowed request headers
CORS_ALLOWED_HEADERS=Content-Type,Authorization

# =================================================================
# REQUEST LIMITS
# =================================================================

# Maximum JSON request body size (1kb-100mb)
REQUEST_JSON_LIMIT=10mb

# Maximum URL-encoded request size (1kb-100mb)
REQUEST_URL_ENCODED_LIMIT=10mb

# =================================================================
# PRODUCTION CONFIGURATION EXAMPLES
# =================================================================
# 
# To convert this to production, change these key values:
# 
# NODE_ENV=production
# LOW_QUALITY_WIDTH=1280
# LOW_QUALITY_HEIGHT=720
# LOW_QUALITY_FPS=15
# LOW_QUALITY_BITRATE=2M
# LOW_QUALITY_PRESET=fast
# LOW_QUALITY_PROFILE=main
# LOW_QUALITY_LEVEL=4.0
# AUDIO_BITRATE=128k
# AUDIO_SAMPLE_RATE=44100
# RETENTION_MINUTES=43200
# CLEANUP_INTERVAL_MINUTES=15
# MAX_STORAGE_GB=500
# INITIAL_CLEANUP_DELAY_SECONDS=30
# ORPHANED_FILE_MAX_AGE_HOURS=6
# FFMPEG_LOG_LEVEL=warning
# ENABLE_RECORDING=true
# RECORDING_SEGMENT_MINUTES=60
# MAX_RESTART_ATTEMPTS=10
# RESTART_DELAY_SECONDS=10
# LOG_LEVEL=info
# LOG_RETENTION_DAYS=30
# LOG_MAX_FILE_SIZE=10485760
# LOG_MAX_FILES=10
# PM2_MAX_MEMORY_RESTART=4G
# PM2_MAX_RESTARTS=15
# PM2_MIN_UPTIME=30s
# PM2_RESTART_DELAY=5000
# PM2_KILL_TIMEOUT=30000
# PM2_LISTEN_TIMEOUT=10000
# PM2_HEALTH_CHECK_GRACE_PERIOD=30000
# NODE_MAX_OLD_SPACE_SIZE=8192
#
# =================================================================
# STORAGE CALCULATION EXAMPLES
# =================================================================
#
# Estimated storage usage per day:
# 640x360@8fps ≈ 1.65 GB/camera/day
# 1280x720@15fps ≈ 9.26 GB/camera/day
#
# For 3 cameras:
# Development: ~5 GB/day
# Production: ~28 GB/day
#
# 30-day retention:
# Development: ~150 GB total
# Production: ~840 GB total
#
# ================================================================= 